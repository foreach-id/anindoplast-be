generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.0.x", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ================= ENUMS =================

enum UserRole {
  SUPER_ADMIN
  ADMIN
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

// ================= MODELS =================

model User {
  id           Int       @id @default(autoincrement())
  name         String    @db.VarChar(255)
  email        String    @unique @db.VarChar(255)
  password     String    @db.VarChar(255)
  isActive     Boolean   @default(true) @map("is_active")
  role         UserRole  @default(ADMIN)
  refreshToken String?   @map("refresh_token") @db.Text
  lastLogin    DateTime? @map("last_login")

  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  //relasi product
  createdProducts Product[] @relation("CreatedProducts")
  updatedProducts Product[] @relation("UpdatedProducts")
  deletedProducts Product[] @relation("DeletedProducts")

  //relasi payment method
  createdPaymentMethods PaymentMethod[] @relation("CreatedPaymentMethods")
  updatedPaymentMethods PaymentMethod[] @relation("UpdatedPaymentMethods")
  deletedPaymentMethods PaymentMethod[] @relation("DeletedPaymentMethods")

  //relasi customer
  createdCustomers Customer[] @relation("CreatedCustomers")
  updatedCustomers Customer[] @relation("UpdatedCustomers")

  //relasi customer address
  createdCustomerAddress CustomerAddress[] @relation("CreatedCustomerAddress")
  updatedCustomerAddress CustomerAddress[] @relation("UpdatedCustomerAddress")

  //relasi order
  createdOrders Order[] @relation("CreatedOrders")
  updatedOrders Order[] @relation("UpdatedOrders")
  deletedOrders Order[] @relation("DeletedOrders")
  
  @@map("users")
}

model Expedition {
  id           Int       @id @default(autoincrement())
  code         String    @unique @db.VarChar(255)
  name         String    @db.VarChar(255)
  isActive     Boolean   @default(true) @map("is_active")

  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  deletedAt    DateTime? @map("deleted_at")

  serviceExpeditions ServiceExpedition[]

  @@map("expeditions")
}

model ServiceExpedition {
  id                           Int        @id @default(autoincrement())
  code                         String     @unique @db.VarChar(255)
  name                         String     @db.VarChar(255)
  description                  String     @db.VarChar(255)
  shippingCodPercent           Int        @map("shipping_cod_percent")
  shippingCostPercent          Int        @map("shipping_cost_percent")
  shippingHandlingCostPercent  Int        @map("shipping_handling_cost_percent")
  isActive                     Boolean    @default(true) @map("is_active")

  expeditionId                 Int?       @map("expedition_id")
  expedition                   Expedition? @relation(fields: [expeditionId], references: [id])

  createdAt                    DateTime   @default(now()) @map("created_at")
  updatedAt                    DateTime   @updatedAt @map("updated_at")
  deletedAt                    DateTime?  @map("deleted_at")

  @@map("service_expeditions")
}

model ProductCategory {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(255)
  insurance   Boolean   @default(false)

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  products    Product[]
  
  @@map("product_categories")
}

model Product {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(255)
  sku         String   @unique @db.VarChar(100) 
  price       Decimal  @db.Decimal(15, 2)
  description String?  @db.Text
  isActive    Boolean  @default(true) @map("is_active")

  weight      Int?     // Gram biasanya Integer
  width       Float?   // Dimensi bisa koma (cm)
  height      Float?
  length      Float?

  categoryId  Int?     @map("category_id")
  category    ProductCategory? @relation(fields: [categoryId], references: [id])

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  createdBy   Int      @map("created_by")
  updatedBy   Int?     @map("updated_by")
  deletedBy   Int?     @map("deleted_by")

  creator     User     @relation("CreatedProducts", fields: [createdBy], references: [id])
  updater     User?    @relation("UpdatedProducts", fields: [updatedBy], references: [id])
  deleter     User?    @relation("DeletedProducts", fields: [deletedBy], references: [id])

  // Relasi ke OrderItem 
  orderItems  OrderItem[]
  @@map("products")
}

model PaymentMethod {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(255)
  isActive    Boolean  @default(true) @map("is_active")

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  createdBy   Int      @map("created_by")
  updatedBy   Int?     @map("updated_by")
  deletedBy   Int?     @map("deleted_by")

  creator     User     @relation("CreatedPaymentMethods", fields: [createdBy], references: [id])
  updater     User?    @relation("UpdatedPaymentMethods", fields: [updatedBy], references: [id])
  deleter     User?    @relation("DeletedPaymentMethods", fields: [deletedBy], references: [id])

  orders      Order[]
  @@map("payment_methods")
}


model Customer {
  id           Int       @id @default(autoincrement())
  name         String    @db.VarChar(255)
  countryCode  String    @map("country_code") @db.VarChar(10)
  phone        String    @db.VarChar(20)

  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  createdBy   Int      @map("created_by")
  updatedBy   Int?     @map("updated_by")

  creator     User     @relation("CreatedCustomers", fields: [createdBy], references: [id])
  updater     User?    @relation("UpdatedCustomers", fields: [updatedBy], references: [id])

  customerAddresses CustomerAddress[]
  orders       Order[]

  @@map("customers")
}

model CustomerAddress {
  id                           Int        @id @default(autoincrement())
  address                      String     @db.VarChar(255)
  zipCode                      String     @map("zip_code") @db.VarChar(20)
  
  provinceId                   Int        @map("province_id")
  provinceName                 String     @map("province_name") @db.VarChar(100)

  cityId                        Int        @map("city_id")
  cityName                      String     @map("city_name") @db.VarChar(100)

  districtId                   Int        @map("district_id")
  districtName                 String     @map("district_name") @db.VarChar(100)
  
  subDistrictId                Int        @map("sub_district_id")
  subDistrictName              String     @map("sub_district_name") @db.VarChar(100)

  customerId                   Int        @map("customer_id")
  customer                     Customer   @relation(fields: [customerId], references: [id])

  createdAt                    DateTime   @default(now()) @map("created_at")
  updatedAt                    DateTime   @updatedAt @map("updated_at")
  createdBy                    Int        @map("created_by")
  updatedBy                    Int?       @map("updated_by")

  creator                      User       @relation("CreatedCustomerAddress", fields: [createdBy], references: [id])
  updater                      User?      @relation("UpdatedCustomerAddress", fields: [updatedBy], references: [id])

  orders                       Order[]
  @@map("customer_addresses")
}

model Order {
  id                  Int              @id @default(autoincrement())
  orderNumber         String           @unique @db.VarChar(50) @map("order_number")
  deliveryNumber      String?          @unique @db.VarChar(50) @map("delivery_number")
  
  customerId          Int              @map("customer_id")
  customer            Customer         @relation(fields: [customerId], references: [id])
  customerName        String           @map("customer_name") @db.VarChar(255)
  customerPhone       String           @map("customer_phone") @db.VarChar(20)
  customerCountryCode String           @map("customer_country_code") @db.VarChar(10)
  
  customerAddressId   Int              @map("customer_address_id")
  customerAddress     CustomerAddress  @relation(fields: [customerAddressId], references: [id])
  customerAddressFull String           @map("customer_address_full") @db.Text
  customerProvince    String           @map("customer_province") @db.VarChar(100)
  customerCity        String           @map("customer_city") @db.VarChar(100)
  customerDistrict    String           @map("customer_district") @db.VarChar(100)
  customerSubDistrict String           @map("customer_sub_district") @db.VarChar(100)
  customerZipCode     String           @map("customer_zip_code") @db.VarChar(20)
  
  paymentMethodId     Int              @map("payment_method_id")
  paymentMethod       PaymentMethod    @relation(fields: [paymentMethodId], references: [id])
  paymentMethodName   String           @map("payment_method_name") @db.VarChar(255)
  
  service             String?          @map("service") @db.VarChar(255)
  serviceName         String?          @map("service_name") @db.VarChar(255)
  serviceType         String?          @map("service_type") @db.VarChar(255)
  isCod               Boolean          @default(false) @map("is_cod")
  isDropOff           Boolean          @default(false) @map("is_drop_off")
  
  orderDate           DateTime         @default(now()) @map("order_date")
  totalAmount         Decimal          @db.Decimal(15, 2) @map("total_amount")
  shippingCost        Decimal          @default(0) @db.Decimal(15, 2) @map("shipping_cost")
  grandTotal          Decimal          @db.Decimal(15, 2) @map("grand_total")
  
  status              OrderStatus      @default(PENDING)
  notes               String?          @db.Text
  
  createdAt           DateTime         @default(now()) @map("created_at")
  updatedAt           DateTime         @updatedAt @map("updated_at")
  deletedAt           DateTime?        @map("deleted_at")
  
  createdBy           Int              @map("created_by")
  updatedBy           Int?             @map("updated_by")
  deletedBy           Int?             @map("deleted_by")
  
  creator             User             @relation("CreatedOrders", fields: [createdBy], references: [id])
  updater             User?            @relation("UpdatedOrders", fields: [updatedBy], references: [id])
  deleter             User?            @relation("DeletedOrders", fields: [deletedBy], references: [id])
  
  orderItems          OrderItem[]
  
  @@map("orders")
}

model OrderItem {
  id          Int      @id @default(autoincrement())
  orderId     Int      @map("order_id")
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  productId   Int      @map("product_id")
  product     Product  @relation(fields: [productId], references: [id])
  productName String   @map("product_name") @db.VarChar(255)
  productSku  String   @map("product_sku") @db.VarChar(100)
  
  productWeight Int?   @map("product_weight")
  productWidth  Float? @map("product_width")
  productHeight Float? @map("product_height")
  productLength Float? @map("product_length")
  
  quantity    Int
  unitPrice   Decimal  @db.Decimal(15, 2) @map("unit_price")
  subtotal    Decimal  @db.Decimal(15, 2)
  
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("order_items")
}